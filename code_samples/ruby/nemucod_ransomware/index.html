<!DOCTYPE html>
<html>
  <head>
  <title>
    
      Resume &lt; Robert Carpenter
    
  </title>
  <link rel="stylesheet" href="/css/stylesheet.css" type="text/css">
  <link rel="stylesheet" href="/css/syntax-highlighting.css" type="text/css">

  <meta charset="utf-8">
</head>

  <body>
    <header>
  <h1 class="pull-left">Robert Carpenter</h1>
  <h5 class="pull-right">Boulder, Colorado</h5>
</header>
<hr>

    <div class='page-content'>
      <div class='wrapper'>
        <div class="section">
  <h3>Ruby CLI: Nemucod Ransomware Recovery Tool</h3>
  <p class="indent"><strong>Written:</strong> Jan, 2017</p>
  <p class="indent"><strong>Abstract:</strong>
    A family member recently became a victim of this scam and asked me for help, but the decryptor available didn't look like it'd run on a mac or linux. I'm always interested in diving into some malware and bit math, so I built this ruby tool to derive the key and decrypt ransomed files.
  </p>
  <p class="indent">
    <strong>Repository:</strong> <a href="https://github.com/robacarp/nemucod_decrypt">Github: robacarp/nemucod_decrypt</a>
  </p>

  <p>
  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="code"><pre>  <span class="c1"># Nemucod prioritizes lockdown speed over encryption viability.</span>
  <span class="c1"># The cipher is a fixed key length xor'd over the first key-length</span>
  <span class="c1"># bytes of the file. This gives the ransomware the ability to</span>
  <span class="c1"># rapidly encrypt thousands of files but results in weak security.</span>
  <span class="k">def</span> <span class="nf">decrypt</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="no">KEY_LENGTH</span> <span class="o">&amp;&amp;</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="vi">@crypted_file</span><span class="p">.</span><span class="nf">size</span>
      <span class="vi">@key_file</span><span class="p">.</span><span class="nf">pos</span> <span class="o">=</span> <span class="n">offset</span>
      <span class="vi">@crypted_file</span><span class="p">.</span><span class="nf">pos</span> <span class="o">=</span> <span class="n">offset</span>
      <span class="vi">@decrypted_file</span><span class="p">.</span><span class="nf">pos</span> <span class="o">=</span> <span class="n">offset</span>

      <span class="n">key_byte</span>     <span class="o">=</span> <span class="vi">@key_file</span><span class="p">.</span><span class="nf">read</span> <span class="mi">1</span>
      <span class="n">crypted_byte</span> <span class="o">=</span> <span class="vi">@crypted_file</span><span class="p">.</span><span class="nf">read</span> <span class="mi">1</span>
      <span class="n">decrypt_byte</span> <span class="o">=</span> <span class="n">pack</span><span class="p">(</span> <span class="n">unpack</span><span class="p">(</span><span class="n">key_byte</span><span class="p">)</span> <span class="o">^</span> <span class="n">unpack</span><span class="p">(</span><span class="n">crypted_byte</span><span class="p">)</span> <span class="p">)</span>

      <span class="vi">@decrypted_file</span><span class="p">.</span><span class="nf">write</span> <span class="n">decrypt_byte</span>

      <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">end</span>

    <span class="vi">@crypted_file</span><span class="p">.</span><span class="nf">close</span>
    <span class="vi">@key_file</span><span class="p">.</span><span class="nf">close</span>
  <span class="k">end</span>
  
</pre></td></tr></tbody></table></code></pre></figure>
  </p>

</div>

      </div>
    </div>
    <hr>

  </body>
</html>
